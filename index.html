<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hall of Fame CS</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <script src="script.js"></script>
  <style>
    .fade-up {
      animation: fadeUp 0.8s ease forwards;
    }
    @keyframes fadeUp {
      0% { opacity: 0; transform: translateY(20px); }
      100% { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <header>
    <h1>üèÜ Hall of Fame CS</h1>
    <p>Highlight Agent Terbaik dan Statistik Live Chat</p>
  </header>
  <nav>
    <a href="#home">Home</a>
    <a href="#resume">Resume</a>
  </nav>
  <section id="home" class="section">
    <h2>Top 3 Agent Bulan Ini</h2>
    <label for="filter">Filter Bulan:</label>
    <select id="filter"></select>
    <div class="top3" id="topAgents"></div>
    <h2>3 Agent Terbawah</h2>
    <div class="bottom3" id="bottomAgents"></div>
  </section>
  <section id="resume" class="section">
    <h2>Grafik Statistik Performa</h2>
    <canvas id="dailyChart"></canvas>
    <canvas id="monthlyChart" style="margin-top: 3rem;"></canvas>
  </section>
  <footer>
    <p>Made with ‚ù§Ô∏è by Tim Customer Experience</p>
  </footer>
  <script>
    const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSafbKaDWKFz7KgimHdBVbMm6mZg-9pmEzLhbwHN2ttWq5HZDcPSRRFgh7n6JNiwGgGAGDKhtQCxat9/pub?output=csv';

    const loadData = () => {
      fetch(SHEET_URL)
        .then(res => res.text())
        .then(csv => {
          const rows = csv.trim().split('\n');
          const headers = rows[0].split(',');
          const data = rows.slice(1).map(row => {
            const values = row.split(',');
            return headers.reduce((obj, key, i) => {
              obj[key.trim()] = values[i].trim();
              return obj;
            }, {});
          });

          // Ambil bulan unik
          const bulan = [...new Set(data.map(d => d['Bulan']))];
          const select = document.getElementById('filter');
          select.innerHTML = bulan.map(b => `<option value="${b}">${b}</option>`).join('');

          const render = (selectedMonth) => {
            const filtered = data.filter(d => d['Bulan'] === selectedMonth);
            filtered.forEach(a => a.CSAT = parseFloat(a.CSAT));
            const sorted = [...filtered].sort((a, b) => b.CSAT - a.CSAT);
            const top3 = sorted.slice(0, 3);
            const bottom3 = sorted.slice(-3);

            const createCard = (agent) => `
              <div class="card fade-up">
                <img src="${agent['Foto'] || 'https://via.placeholder.com/120'}" alt="${agent['Agent']}" />
                <h3>${agent['Agent']}</h3>
                <p>CSAT: ${agent['CSAT']}%</p>
                <p>Total Chat: ${agent['Total Conversation']}</p>
                <p>Komplain: ${agent['Total Komplain']}</p>
              </div>
            `;

            document.getElementById('topAgents').innerHTML = top3.map(createCard).join('');
            document.getElementById('bottomAgents').innerHTML = bottom3.map(createCard).join('');

            // Chart update
            const dailyLabel = filtered.map(a => a['Agent']);
            const daily = filtered.map(a => parseFloat(a['CSAT']));

            new Chart(document.getElementById('dailyChart'), {
              type: 'line',
              data: {
                labels: dailyLabel,
                datasets: [{
                  label: 'CSAT Harian (%)',
                  data: daily,
                  borderColor: 'coral',
                  fill: false
                }]
              },
              options: {
                responsive: true,
                plugins: { legend: { display: true } }
              }
            });

            new Chart(document.getElementById('monthlyChart'), {
              type: 'bar',
              data: {
                labels: dailyLabel,
                datasets: [{
                  label: 'CSAT Bulanan (%)',
                  data: daily,
                  backgroundColor: 'lightblue'
                }]
              },
              options: {
                responsive: true,
                plugins: { legend: { display: false } }
              }
            });
          };

          // Default: tampilkan bulan terakhir
          render(bulan[bulan.length - 1]);

          select.addEventListener('change', (e) => render(e.target.value));
        });
    }

    // Auto-refresh setiap hari
    loadData();
    setInterval(loadData, 86400000); // 86400000 ms = 1 hari
  </script>
</body>
</html>
